---
phase: 04-mcp-server
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - requirements.txt
  - app.py
  - mcp_server.py
autonomous: true

must_haves:
  truths:
    - "FastMCP is installed as a project dependency"
    - "mcp_server.py file exists with FastMCP server instance"
    - "FastMCP server is configured to use HTTP transport on port 8000"
    - "FastMCP server can be started with python mcp_server.py"
    - "MCP endpoint is accessible at http://localhost:8000/mcp"
    - "Server health check is accessible at http://localhost:8000/health"
  artifacts:
    - path: "requirements.txt"
      provides: "FastMCP dependency declaration"
      contains: "fastmcp"
    - path: "mcp_server.py"
      provides: "FastMCP server instance with HTTP transport"
      exports: ["mcp", "create_mcp_app"]
      min_lines: 50
  key_links:
    - from: "mcp_server.py"
      to: "fastmcp.FastMCP"
      via: "import statement"
      pattern: "from fastmcp import FastMCP"
    - from: "mcp_server.py"
      to: "HTTP transport"
      via: "mcp.run() call"
      pattern: 'transport=["\']http["\']'
---

<objective>
Create FastMCP server infrastructure with HTTP transport for n8n integration.

Purpose: Set up the foundation for MCP (Model Context Protocol) server that will expose YouTube data fetching tools to AI agents through a streamable HTTP interface.
Output: Working FastMCP server on HTTP transport with health check endpoint, ready for tool registration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-mcp-server/04-CONTEXT.md
@app.py
@requirements.txt
</context>

<tasks>

<task type="auto">
  <name>Add FastMCP to requirements.txt</name>
  <files>requirements.txt</files>
  <action>
    Add `fastmcp>=3.0.0` to requirements.txt on a new line at the end of the file.

    FastMCP version 3.0.0 or later is required for:
    - HTTP transport support (Streamable HTTP protocol)
    - ASGI application mode for deployment
    - Auto-reload functionality for development
    - Proper integration with n8n workflows

    Place the line after the `isodate>=0.6.1` line.
  </action>
  <verify>grep -q "fastmcp" requirements.txt</verify>
  <done>requirements.txt includes fastmcp>=3.0.0 dependency</done>
</task>

<task type="auto">
  <name>Create mcp_server.py with FastMCP instance and HTTP transport</name>
  <files>mcp_server.py</files>
  <action>
    Create a new file mcp_server.py with the following structure:

    1. Import FastMCP from fastmcp
    2. Import Request and PlainTextResponse from starlette.requests and starlette.responses
    3. Create FastMCP instance: `mcp = FastMCP("YouTube Data Fetcher")`
    4. Add a health check custom route:
       - Use @mcp.custom_route("/health", methods=["GET"])
       - Return PlainTextResponse("OK")
    5. Add a placeholder tool (will be expanded in next plan):
       - Use @mcp.tool decorator
       - Create analyze_video_placeholder(video_url_or_id: str) -> str function
       - Return "Tool not yet implemented" message
    6. Create create_mcp_app() function that returns mcp.http_app()
    7. Add if __name__ == "__main__" block:
       - Call mcp.run(transport="http", host="0.0.0.0", port=8000)

    This provides:
    - FastMCP server instance with HTTP transport on port 8000
    - Health check endpoint at http://localhost:8000/health
    - MCP endpoint at http://localhost:8000/mcp
    - ASGI app for production deployment (via create_mcp_app())
  </action>
  <verify>test -f mcp_server.py && grep -q "FastMCP" mcp_server.py && grep -q "transport=\"http\"" mcp_server.py</verify>
  <done>mcp_server.py exists with FastMCP instance, HTTP transport configuration, health check endpoint, and placeholder tool</done>
</task>

<task type="auto">
  <name>Install FastMCP dependency</name>
  <files>None (command execution)</files>
  <action>
    Run `pip install -r requirements.txt` to install the fastmcp package and its dependencies.

    This ensures FastMCP is available for import when the MCP server starts.

    Note: This task should complete successfully with no errors about fastmcp not being found.
  </action>
  <verify>python -c "import fastmcp; print(fastmcp.__version__)" 2>&1 | grep -v "No module named"</verify>
  <done>FastMCP package is installed and importable in Python environment</done>
</task>

</tasks>

<verification>
After completion, verify:
1. `python -c "from fastmcp import FastMCP; print('FastMCP imported successfully')"` - no import errors
2. `python mcp_server.py` starts server on http://0.0.0.0:8000
3. Server logs show "MCP endpoint available at http://0.0.0.0:8000/mcp" or similar
4. Health check: `curl http://localhost:8000/health` returns "OK"
5. MCP endpoint: `curl http://localhost:8000/mcp` returns JSON with MCP protocol info
6. Verify HTTP transport is active (not stdio) - logs should mention HTTP/SSE
</verification>

<success_criteria>
1. FastMCP dependency is installed and version is >= 3.0.0
2. mcp_server.py file exists with FastMCP server instance
3. Server starts without errors on port 8000
4. Health check endpoint returns "OK"
5. MCP endpoint is accessible and returns valid MCP protocol response
6. Server is configured for HTTP transport (not stdio)
7. ASGI app can be retrieved via create_mcp_app() for production deployment
</success_criteria>

<output>
After completion, create `.planning/phases/04-mcp-server/04-01-SUMMARY.md` with:
- FastMCP version installed
- Server configuration (transport, host, port)
- Health check endpoint details
- MCP endpoint URL
- Any deviations from plan (e.g., version differences)
</output>
